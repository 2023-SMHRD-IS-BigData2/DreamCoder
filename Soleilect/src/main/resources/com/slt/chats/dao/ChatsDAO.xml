<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.slt.chats.dao.ChatsDAO">

	<insert id="chatsInfoInsert"
		parameterType="com.slt.entity.Chats">
		insert into CHATS_TB(chat_msg, receiver_id,
		receiver_nick, sender_id,
		sender_nick, created_at)
		values(#{chat_msg},#{receiver_id},#{receiver_nick},#{sender_id},#{sender_nick},NOW());
	</insert>

	<select id="chatsSelectList"
		parameterType="com.slt.entity.Chats" resultType="com.slt.entity.Chats">
		select chat_seq, chat_msg, receiver_id, receiver_nick, sender_id, sender_nick,
		created_at, cancel_sender, delete_id
		from CHATS_TB
		where receiver_id IN (#{receiver_id}, #{sender_id})
		AND sender_id IN (#{receiver_id}, #{sender_id})
		AND receiver_id != sender_id
		AND delete_id IS NULL
		OR delete_id NOT IN (#{sender_id});
	</select>
	
	<update id="chatsCancelUpdate">
		UPDATE CHATS_TB SET cancel_sender = 1 WHERE chat_seq = #{num};
	</update>
	
	<update id="chatsUpdateDelete" parameterType="com.slt.entity.Chats">
		UPDATE CHATS_TB SET delete_id = #{sender_id} WHERE chat_seq IN (#{chat_seq});
	</update>
	
	<delete id="chatsDelete">
		delete CHATS_TB where chat_seq = #{num};
	</delete>

</mapper>
